<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <title>NIC</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/form.css">
  <link rel="stylesheet" href="/css/routine.css">
  <link rel="stylesheet" href="/css/alert.css">
  <link rel="stylesheet" href="/css/table.css">
  <script src="/script/alert.js"></script>
  <script src="/script/dynamic_fields.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
  <div th:replace="~{fragment/nav :: nav}"> </div>
    <main>
      <div id="tablelist">
      <div class="grid">
        <div class="wrapper">
          <select name="" id="TempLevel">
            <option value="Select Level">Select Level</option>
            <option value="District">District</option>
            <option value="Taluk">Taluk</option>
          </select>
        </div>
        <div class="wrapper" >
          <select  id="deptDrop" ></select>
        </div>
        <div class="wrapper">
          <input type="text" id="TempName" required>
          <label>Templet Name</label>
        </div>
      </div>

      <div id="inputContainer" class="input-container">
      </div>
      <button id="addButton">Add Input Field</button>

      <div class="btn">
        <button onclick="saveTemplet()" class="submit-btn">Add</button>
<!--        <button class="cancel-btn">Cancel</button>-->
      </div>
      <div class="alert-container" id="alertContainer">
        <div class="alert-message">
          Added Data Successfully!
          <button class="alert-button-ok" onclick="hideAlert()">OK</button>
          <button class="alert-button-cancel" onclick="location.reload()">Cancel</button>
        </div>
      </div>


        <div class="table-name">
          <h2>Templates</h2>
        </div>
        <div class="table-container">
          <table>
            <thead>
            <tr>
              <th>Templet Name</th>
              <th>Level</th>
              <th>Department</th>
              <th>Actions</th>
            </tr>
            </thead>
            <tbody id="tempList">

            </tbody>
          </table>
        </div>
      </div>

      <div id="questions">
        <div class="table-container">
          <table>
            <tr>
              <th class="assign-head">Template Name</th>
              <td id="TempNameSing"></td>
            </tr>
            <tr>
              <th class="assign-head">Level</th>
              <td id="TempLevelSing"></td>
            </tr>
            <tr>
              <th class="assign-head">Department</th>
              <td id="TempDeptSing"></td>
            </tr>
            <tr>
              <th class="assign-head">Questions</th>
              <td id="TempDescriptionSing"></td>
            </tr>
          </table>
        </div>
      </div>
    </main>
</body>
<script>

    $(document).ready(function() {

    <!--        Department dropdown list start-->

            $.ajax({
               contentType: "application/json;charset=UTF-8",
               type: "GET",
               url: "/api/department/getAllDept",
               dataType: "json",
               async:false,
               success: function (deptdata) {
                   var s = '<option value="-1">Select Department</option>';
                   for (var i = 0; i < deptdata.length; i++) {
                       s += '<option value="' + deptdata[i].deptName + '">' + deptdata[i].deptName + '</option>';
                   }
                   $("#deptDrop").html(s);
               }
           });

    <!--        Department dropdown list end-->

        $("#tablelist").show();
        $("#questions").hide();

        var tempList="";
        $.ajax({
            contentType: "application/json;charset=UTF-8",
            url: "/api/quetemplet/getAllTemp",
            dataType: "json",
            type: "GET",
            async:false,
            success:function(data){
               for(i=0;i<data.length;i++){

                 if(data[i].routassignedOfficer!==null && data[i].lastDate!==null){
                     tempList += '<tr id="' + data[i].tempId + '">'; // Add ID attribute
                     tempList=tempList+' <td>'+data[i].tempName +'</td>';
                     tempList=tempList+' <td>'+data[i].tempLevel +'</td>';
                     tempList=tempList+' <td>'+data[i].tempDept +'</td>';

                     tempList=tempList+' <td>';
                     tempList=tempList+'<a href="javascript:gettemp(\''+data[i].tempId+'\')" title="View">';
                     tempList=tempList+'<i>&#x1F441;</i> </a>';
                     tempList=tempList+'<a href="javascript:deleteTemp(\''+data[i].tempId+'\')" title="Delete">';
                     tempList=tempList+'<b style="color:#FF0000">&#x1F5D1;</b> </a>';
                     tempList=tempList+'</td></tr>';
                 }

               }

                $("#tempList").html(tempList);
            }
        });
      });


      function saveTemplet() {
            const userData = {
                tempName: $("#TempName").val(),
                tempLevel: $("#TempLevel").val(),
                tempDept: $("#deptDrop").val(),
                tempDiscription: [],

            };

            // Get all dynamically generated input fields with their tempAns values
               $("#inputContainer").find(".input-container").each(function() {
                const tempContent = $(this).find("input[type='text']").val();
                const imgReqCheckbox = $(this).find("input[type='checkbox']");

                // Determine the value for imgReq based on checkbox status
                const imgReqValue = imgReqCheckbox.is(":checked") ? "Yes" : "No";

                // Create an object for each tempContent and imgReq
                const tempObject = {
                    tempContent: tempContent,
                    imgReq: imgReqValue
                };

                // Push the object to the tempDiscription array
                userData.tempDiscription.push(tempObject);
            });



            $.ajax({
                contentType: "application/json;charset=UTF-8",
                url: "/api/quetemplet/save",
                dataType: "json",
                type: "POST",
                cache: !1,
                processData: !1,
                data: JSON.stringify(userData),
                success: function(response) {
                    console.log(response); // If needed, handle the response from the server
                },
                error: function(error) {
                    console.error("error"); // If needed, handle the error from the server
                }
            });

            showAlert();
        }

        function gettempId(id){
                 $.ajax({
                       contentType: "application/json;charset=UTF-8",
                       url: "${pageContext.request.contextPath}api/quetemplet/getById/" + id,
                       dataType: "json",
                       type: "GET",
                       success:function(data){
                          getProfile(data)

                       }
                  });
            }


        function gettemp(id) {
            $("#tablelist").hide();
            $("#questions").show();

            $.ajax({
                contentType: "application/json;charset=UTF-8",
                url: "/api/quetemplet/getById/" + id,
                dataType: "json",
                type: "GET",
                cache: !1,
                processData: !1,
                success: function(data) {

                    $("#TempIdSing").text(data.tempId);
                    $("#TempNameSing").text(data.tempName);
                    $("#TempLevelSing").text(data.tempLevel);
                    $("#TempDeptSing").text(data.tempDept);

                    var descriptionHtml = '';
                    for (var i = 0; i < data.tempDiscription.length; i++) {
                        descriptionHtml += data.tempDiscription[i].tempContent + '<br>';
                    }
                    $("#TempDescriptionSing").html(descriptionHtml);

                }
            });
        }

         function deleteTemp(id) {
            if (confirm("Are you sure you want to delete this templet?")) {
                $.ajax({
                    contentType: "application/json;charset=UTF-8",
                    url: "/api/quetemplet/delete/" + id, // Use the delete endpoint with the tempId
                    type: "DELETE",
                    success: function () {
                        // Remove the deleted row from the displayed table
                        $("#" + id).remove();
                        alert("Template deleted successfully.");
                    },
                    error: function (xhr, status, error) {
                        alert("Failed to delete templet: " + error);
                    },
                });
            }
        }

</script>
</html>